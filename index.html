<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

</head>
<body>
    <nav class="navbar navbar-expand-lg bg-primary">
        <div class="container-fluid" id="mynavbar">
            <a class="navbar-brand" href="#">Store</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup"
                aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                <div class="navbar-nav">
                    <a class="nav-link" href="index.html">Home</a>
                    <a class="nav-link" href="cart.html">Cart</a>
                </div>
            </div>
            <form class="d-flex me-5" role="search">
                <button class="btn btn-outline-light me-2" onclick="filter()">Search</button>
                <input class="form-control" id="keyword" type="search" placeholder="Search" aria-label="Search" />
            </form>
        </div>    
    </nav>

    <div class="container mt-5">
        <div class="row">
            <div class="col-2">
                <select id="category" class="form-select form-select-sm mb-3" aria-label="Small select example">
                    <option selected>Category</option>
                    <option value="1">Leptop</option>
                    <option value="2">Phone</option>
                </select>
                <select id="brand" class="form-select form-select-sm mb-3" aria-label="Small select example">
                    <option selected>Brand</option>
                    <option value="lenovo">lenovo</option>
                    <option value="asus">asus</option>
                    <option value="acer">acer</option>
                    <option value="apple">apple</option>
                    <option value="hp">hp</option>
                    <option value="samsung">samsung</option>
                    <option value="lg">lg</option>
                    <option value="xiaomi">xiaomi</option>
                </select>
                <select id="sort_by" class="form-select form-select-sm mb-3" aria-label="Small select example">
                    <option selected>Sort by</option>
                    <option value="price">pricce</option>
                    <option value="rating">rating</option>
                </select>
                <select id="sort_direction" class="form-select form-select-sm mb-3" aria-label="Small select example">
                    <option selected>Sort direction</option>
                    <option value="desc">high to low</option>
                    <option value="asc">low to high</option>
                </select>
                <button class="btn btn-primary" onclick="filter()">filter</button>
            </div>
            <div class="col-10">
                <div class="container">
                    <div class="row" id="row"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        function asamble_page(response){
            response.data.products.forEach(function(product){
                var col = document.createElement("div")
                col.className = "col-lg-3 col-6 mb-4"

                var card = document.createElement("div")
                card.className = "card h-100"

                var img = document.createElement("img")
                img.src = product.thumbnail
                img.className = "card-img-top"
                img.style.height = "200px"
                img.style.objectFit = "contain"

                var cardBody = document.createElement("div")
                cardBody.className = "card-body"

                var title = document.createElement("h5")
                title.textContent = product.title
                title.className = "card-title"
                title.onclick =  function(){
                    window.location.href = "product.html?id=" + product._id
                }

                var price = document.createElement("p")
                price.textContent = "$" + product.price.current
                price.clasName = "card-text"

                var rating = document.createElement("p")
                rating.textContent = "rating: " + product.rating.toFixed(1)
                rating.clasName = "card-text"

                var addToCart = document.createElement("button")
                addToCart.textContent = "add to cart"
                addToCart.className = "btn btn-primary"
                addToCart.onclick = function(){
                    addToCart_f(product._id)
                } 

                cardBody.appendChild(title)
                cardBody.appendChild(price)
                cardBody.appendChild(rating)
                cardBody.appendChild(addToCart)

                card.appendChild(img)
                card.appendChild(cardBody)

                col.appendChild(card)

                document.getElementById("row").appendChild(col)
            })
        }

        axios.get("https://api.everrest.educata.dev/shop/products/all?page_size=32").then(function(response){
            asamble_page(response)
        }).catch(function(error) {
            console.log(error)
        })
        function filter(){
            let keyword = document.getElementById("keyword").value
            let category = document.getElementById("category").value
            let brand = document.getElementById("brand").value
            let sort_by = document.getElementById("sort_by").value
            let sort_direction = document.getElementById("sort_direction").value
            let filter_url = "https://api.everrest.educata.dev/shop/products/search?page_size=32&"
            if (keyword !== ""){
                filter_url += "keywords=" + keyword + "&"
            }
            if (category !== "Category"){
                filter_url += "category_id=" + category + "&"
            }
            if (brand !== "Brand"){
                filter_url += "brand=" + brand + "&"
            }
            if (sort_by !== "Sort by"){
                filter_url += "sort_by=" + sort_by + "&"
            }
            if (sort_direction !== "Sort direction" && sort_by !== "Sort_by"){
                filter_url += "sort_direction=" + sort_direction + "&"
            }

            axios.get(filter_url).then(function(response){
                document.getElementById("row").innerHTML = ""
                asamble_page(response)
            }).catch(function(error){
                console.log(error)
            })
        }
    </script>
</body>
</html>