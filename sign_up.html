<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sign_up</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center mt-5">
            <div class="col-6">
                <h2 class="h2">Sign up</h2>
                <form onsubmit="login(event)">
                    <div class="form-group mt-3">
                        <label>first name</label>
                        <input type="text" class="form-control" id="first_name" name="first_name">
                    </div>
                    <div class="form-group mt-3">
                        <label>last name</label>
                        <input type="text" class="form-control" id="last_name" name="last_name">
                    </div>
                    <div class="form-group mt-3">
                        <label>age</label>
                        <input type="number" class="form-control" id="age" name="age">
                    </div>
                    <div class="form-group mt-3">
                        <label>address</label>
                        <input type="text" class="form-control" id="address" name="address">
                    </div>
                    <div class="form-group mt-3">
                        <label>zip code</label>
                        <input type="number" class="form-control" id="zip" name="zip">
                    </div>
                    <div class="form-group mt-3">
                        <label>phone</label>
                        <input type="tel" class="form-control" id="phone" name="phone">
                    </div>
                    <div class="form-group mt-3">
                        <label>email</label>
                        <input type="email" class="form-control" id="email" name="email">
                    </div>
                    <div class="form-group mt-3">
                        <label>password</label>
                        <input type="password" class="form-control" id="password" name="password">
                    </div>
                    <div class="form-group mt-3">
                        <label>avatar</label>
                        <input type="text" class="form-control" id="avatar" name="avatar">
                    </div>
                    <select class="form-select mt-3" id="gender" name="gender">
                        <option selected>gender</option>
                        <option value="MALE">male</option>
                        <option value="FEMALE">female</option>
                    </select>
                    <button type="submit" class="btn btn-primary mt-3">sign up</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        function login(event) {
            event.preventDefault()

            const fields = {
                email: document.getElementById("email"),
                password: document.getElementById("password"),
                first_name: document.getElementById("first_name"),
                last_name: document.getElementById("last_name"),
                age: document.getElementById("age"),
                phone: document.getElementById("phone"),
                avatar: document.getElementById("avatar"),
                gender: document.getElementById("gender"),
                zip: document.getElementById("zip"),
                address: document.getElementById("address")
            }

            const emptyFields = Object.entries(fields)
                .filter(([key, field]) => {
                    if (key === 'gender') {
                        return field.value === 'gender'
                    }
                    return !field.value.trim()
                })
                .map(([key]) => key)

            if (emptyFields.length > 0) {
                window.alert(`Please fill in all fields. Missing: ${emptyFields.join(', ')}`)
            } else {
                axios.post("https://api.everrest.educata.dev/auth/sign_up", {
                    email: fields.email.value,
                    password: fields.password.value,
                    firstName: fields.first_name.value,
                    lastName: fields.last_name.value,
                    age: Number(fields.age.value),
                    phone: fields.phone.value,
                    avatar: fields.avatar.value,
                    gender: fields.gender.value,
                    zip: fields.zip.value,
                    address: fields.address.value
                }
                ).then(function(response){
                    console.log(response)
                    window.localStorage.setItem("access_token", response.data.access_token)
                    window.location.href = "index.html"
                }).catch(function(error){
                    window.alert("something went wrong failed try again")
                    console.log(error)
                })
            }
        }
    </script>
    </body>
</html>